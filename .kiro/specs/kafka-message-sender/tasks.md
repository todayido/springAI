# 实施计划

- [x] 1. 创建数据模型和基础结构
  - 创建GmTestMessage数据模型类，包含所有gm-test-mappings.json中定义的字段
  - 创建Author、Attachment、Metrics、GeoPoint等嵌套对象模型
  - 实现数据模型的构造函数、getter/setter方法
  - _需求: 1.1, 2.1_

- [ ] 2. 实现消息构建服务
- [ ] 2.1 创建MessageBuilderService接口和实现类
  - 定义消息构建的核心接口方法
  - 实现基于gm-test-mappings.json结构的消息构建逻辑
  - _需求: 1.2, 2.2_

- [ ] 2.2 实现样本数据生成功能
  - 为每种数据类型实现合理的样本数据生成逻辑
  - 实现嵌套对象和数组的样本数据生成
  - 确保生成的数据符合schema要求
  - _需求: 2.2, 2.3_

- [ ] 2.3 实现自定义数据转换功能
  - 支持从Map<String, Object>转换为GmTestMessage对象
  - 实现数据类型转换和默认值填充
  - _需求: 2.2_

- [ ] 2.4 实现JSON序列化功能
  - 将GmTestMessage对象转换为JSON字符串
  - 确保日期格式和特殊字段的正确序列化
  - _需求: 1.2_

- [ ] 3. 实现数据验证器
- [ ] 3.1 创建DataValidator类
  - 实现字段类型验证逻辑
  - 实现必填字段检查
  - 实现数据格式验证（如邮箱、日期格式等）
  - _需求: 1.1_

- [ ] 3.2 实现嵌套对象验证
  - 验证author对象的完整性
  - 验证attachments数组中每个元素的结构
  - 验证metrics对象的字段
  - _需求: 1.1_

- [ ] 3.3 编写数据验证单元测试
  - 测试各种有效和无效数据场景
  - 测试边界条件和异常情况
  - _需求: 1.1_

- [ ] 4. 实现消息验证服务
- [ ] 4.1 创建MessageVerificationService接口和实现类
  - 实现跟踪ID生成逻辑
  - 实现消息状态跟踪功能
  - 创建MessageStatus和MessageTrackingInfo数据结构
  - _需求: 3.1, 3.2_

- [ ] 4.2 实现消息状态管理
  - 实现消息发送状态记录
  - 实现消息接收状态更新
  - 实现状态查询功能
  - _需求: 3.2, 3.3_

- [ ] 4.3 实现消息历史记录功能
  - 维护最近消息的内存缓存
  - 实现消息列表查询接口
  - _需求: 3.5_

- [ ] 5. 增强KafkaTestController
- [ ] 5.1 添加结构化消息发送端点
  - 实现/send-structured端点，支持自定义数据输入
  - 集成MessageBuilderService和DataValidator
  - 实现详细的响应信息返回
  - _需求: 1.3, 1.4_

- [ ] 5.2 添加样本消息发送端点
  - 实现/send-sample端点，自动生成样本数据
  - 集成消息构建和发送逻辑
  - _需求: 2.2, 2.3_

- [ ] 5.3 添加消息验证端点
  - 实现/verify/{trackingId}端点查询消息状态
  - 实现/recent-messages端点获取最近消息列表
  - _需求: 3.2, 3.3_

- [ ] 5.4 实现错误处理和响应格式
  - 统一错误响应格式
  - 实现详细的错误信息返回
  - 添加适当的HTTP状态码
  - _需求: 1.4_

- [ ] 6. 更新消费者服务集成验证
- [ ] 6.1 修改KafkaConsumerService以支持消息验证
  - 在消息处理时更新验证服务的状态
  - 实现消息处理成功/失败的状态反馈
  - _需求: 3.3, 3.4_

- [ ] 6.2 改进消息处理逻辑
  - 优化JSON解析和Elasticsearch存储逻辑
  - 添加更详细的日志记录
  - _需求: 3.4_

- [ ] 7. 创建响应模型类
- [ ] 7.1 创建MessageSendResponse类
  - 包含跟踪ID、状态、时间戳等信息
  - 实现成功和错误响应的统一格式
  - _需求: 1.4_

- [ ] 7.2 创建错误响应模型
  - 实现统一的错误响应结构
  - 支持详细的错误信息和字段级别的验证错误
  - _需求: 1.4_

- [ ] 8. 编写集成测试
  - 测试完整的消息发送和验证流程
  - 测试错误场景和异常处理
  - 验证Kafka到Elasticsearch的数据流
  - _需求: 1.5, 2.5, 3.5_

- [ ] 9. 配置和文档完善
- [ ] 9.1 添加必要的配置属性
  - 在application.properties中添加消息发送相关配置
  - 配置消息验证和缓存参数
  - _需求: 所有需求_

- [ ] 9.2 更新API文档
  - 为新的端点添加详细的API文档注释
  - 提供请求和响应示例
  - _需求: 1.4_